---
title: "Homework 4 Submission"
author: "Yahriel Salinas-Reyes"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
rm(list = ls(all=TRUE))
graphics.off()
shell("cls")
knitr::opts_chunk$set(echo = TRUE)
```



```{r, include=FALSE}
library(readxl)
library(here)
library(epiR)
library(MASS)
library(nnet)
library(car)
library(PairedData)
library(tidyverse)
library(ggplot2)
library(pwr)
library(FSA)
library(ggpubr)
library(rstatix)
library(datarium)
library(emmeans)
library(sjstats)
library(lme4)
library(lmerTest)
library(MuMIn)
library(forcats)

library(readxl)  
library(tidyverse)  
library(dplyr)  
library(ggplot2)  
library(pwr)  
library(ggpubr)  
library(rstatix)  
library(datarium)  
library(emmeans)  
library(sjstats)  
library(lme4)  
library(lmerTest)  
library(MuMIn)  
library(dplyr)  
library(forcats)  

## Import Data Sets
alcohol <- read_excel("alcohol.xls")
ischemic <- read_excel("ischemic.xls")
lowbwt <- read_excel("lowbwt.xls")
water <- read_excel("water.xls")
actions <- read_excel("actions.xls")
hospital <- read_excel("hospital.xls")
heart <- read_excel("heart.xls")
detroit <- read_excel("detroit.xls")
stenosis <- read_excel("stenosis.xls")
dialysis <- read_excel("dialysis.xls")
cyto <- read_excel("cyto.xls")
bladder <- read_excel("bladder.xls")
```

# Question 1
a. Evaluate the null hypothesis that the population proportions of students who drove while drinking are the same in the two calendar years (2010 and 2014).

> For this analysis, we can use the Chi-square test to compare the proportions of students who drove while drinking in both years.

```{r, out.width="60%",}
# Create the contingency table
data1 <- matrix(c(1250, 991, 1387, 1666), nrow = 2, byrow = TRUE)
colnames(data1) <- c("2010", "2014")
rownames(data1) <- c("Yes", "No")
data1 <- as.table(data1)

# Perform the Chi-square test
chi_square_test <- chisq.test(data1)

# Print the result
print(chi_square_test)

```
b. What do you conclude about the behavior of college students?

> Since the p-value (1.241e-13) from the Chi-squared rest is less than the significance level, we reject the null hypothesis, indicating that there is a significant difference in the proportions of students who drove while drinking between the two years.

# Question 2
a. Do these data support the null hypothesis that there is no association between the time of screening and diagnosis?

> Here, we can also use the Chi-square test to assess the association between the first and second screenings.

```{r, out.width="60%",}
# Create the contingency table
data2 <- matrix(c(1763, 489, 403, 670), nrow = 2, byrow = TRUE)
colnames(data2) <- c("Present", "Absent")
rownames(data2) <- c("Present", "Absent")
data2 <- as.table(data2)

# Perform the Chi-square test
chi_square_test2 <- chisq.test(data2)

# Print the result
print(chi_square_test2)

```

> Since the p-value (< 2.2e-16) from the Chi-squared rest is less than the significance level, we reject the null hypothesis, indicating that there is a significant difference or association between the time of screening and diagnosis.

b. The data could also be displayed in a different manner. Is there anything wrong with this presentation? Why?

> The alternative presentation aggregates the results, which could obscure variability in the data. This format might hide differences in screening consistency between the two tests, making it challenging to assess intra-observer reliability accurately.

# Question 3
a. Test the null hypothesis that there is no association between drinking status on the two different types of questionnaires.

> Since we want to compare two categorical variables (drinking status from two different questionnaires), a Chi-square test is appropriate.

```{r, out.width="60%",}
# Load the necessary library
library(readxl)

# Import the dataset
alcohol_data <- read_excel("alcohol.xls")

# Create a contingency table
contingency_table <- table(alcohol_data$genques, alcohol_data$alcques)

# Perform the Chi-square test
chi_square_result <- chisq.test(contingency_table)

# Display the result
print(chi_square_result)

```
b. What do you conclude?

> Based on the p-value from the Chi-square test result which is less than 0.05, we reject the null hypothesis and we can conclude there is a significant association between the two questionnaires.

# Question 4
a. Create a two-way scatter plot for these data.
```{r, out.width="60%",}
# Load the necessary library
library(readxl)
library(ggplot2)

# Import the dataset
ischemic_data <- read_excel("ischemic.xls")

# Create a scatter plot
ggplot(ischemic_data, aes(x = time, y = duration)) +
  geom_point() +
  labs(title = "Scatter Plot of Time to Angina vs Duration of Angina",
       x = "Time to Angina (seconds)",
       y = "Duration of Angina (seconds)")
```
b. In the population of patients with ischemic heart disease, does there appear to be any evidence of a linear relationship between time to angina and the duration of the attack?

> We can inspect the scatter plot for a linear trend. Since the points suggest a linear relationship, we can proceed with correlation analysis.

c. In calculating the correlation coefficient, which test will you use, Pearson or Spearman? Why?

> Since both variables are continuous and likely normally distributed, use Pearson's correlation. If not normally distributed, use Spearman.

d. Test the null hypothesis that the population correlation is equal to 0.

```{r, out.width="60%",}
# Perform hypothesis test for correlation
cor_test_result <- cor.test(ischemic_data$time, ischemic_data$duration)

# Print results
cor_test_result
```
> Since the p-value here is greater than 0.05, then we fail to reject the null and conclude that there is no significant correlation, correlation = 0. 

# Question 5

> Use Spearman's rank correlation because the Apgar score is ordinal.

```{r, out.width="60%",}
# Import dataset
lowbwt <- read_excel("lowbwt.xls")



# Conduct Spearman correlation
spearman_result <- cor.test(lowbwt$sbp, lowbwt$apgar5, method="spearman")

# Print results
spearman_result

```
b. Null hypothesis and conclusion?

> We fail to reject the null hypothesis that there is no correlation between systolic blood pressure and Apgar score, since the p-value is greater than 0.05.

# Question 6
a. Construct a scatter plot for these data.
b. Calculate correlation.
c. Is this correlation significantly different from 0?
```{r, out.width="60%",}
# Import dataset
water <- read_excel("water.xls")

# Create scatter plot
plot(water$fluoride, water$caries,
     main="Scatter Plot of Fluoride vs Dental Caries",
     xlab="Fluoride Content (ppm)",
     ylab="Number of Caries per 100 Children",
     pch=19, col='green')

## B. 
# Calculate correlation
fluoride_caries_correlation <- cor(water$fluoride, water$caries)
fluoride_caries_correlation

## C. 
# Conduct hypothesis test
correlation_test <- cor.test(water$fluoride, water$caries)

# Print results
correlation_test

```
> Since the p-value is than 0.05, we conclude that the correlation is significantly different from 0.

# Question 7
a. Calculate correlations between ranks.
b. Is each correlation significantly different from 0?

```{r, out.width="60%",}
# Import dataset
actions <- read_excel("actions.xls")

# Calculate correlations
correlation_1991_1992 <- cor(actions$rank91, actions$rank92)
correlation_1991_1993 <- cor(actions$rank91, actions$rank93)
correlation_1991_1994 <- cor(actions$rank91, actions$rank94)
correlation_1991_1995 <- cor(actions$rank91, actions$rank95)

# Print results
correlation_1991_1992
correlation_1991_1993
correlation_1991_1994
correlation_1991_1995
## The Correlation decreases with the increasing year. 

## B. 
# Conduct hypothesis tests
test_1991_1992 <- cor.test(actions$rank91, actions$rank92)
test_1991_1993 <- cor.test(actions$rank91, actions$rank93)
test_1991_1994 <- cor.test(actions$rank91, actions$rank94)
test_1991_1995 <- cor.test(actions$rank91, actions$rank95)

# Print results
test_1991_1992
test_1991_1993
test_1991_1994
test_1991_1995
 
## Yes, they all are significanctly different from zero.
```
c. Are states equally strict?

> Since the correlations are low as years increase, it may indicate inconsistency among states.

# Question 8

```{r, out.width="60%",}

# Import dataset
library(readxl)
lowbwt <- read_excel("lowbwt.xls")


# a. Compute least-squares regression line
lm_sbp_gestage <- lm(sbp ~ gestage, data = lowbwt)
summary(lm_sbp_gestage)

# Interpretation: The estimated slope (b1) represents the change in systolic blood pressure for each week increase in gestational age.

# b. Hypothesis Test for Slope
summary(lm_sbp_gestage)$coefficients

# Interpretation: Since the P-value for b1 is less than 0.05, we conclude that b1 differs significantly from zero.

# c. Predicted systolic blood pressure at gestational age of 31 weeks
predict(lm_sbp_gestage, newdata = data.frame(gestage = 31))

```

# Question 9


```{r, out.width="60%",}
# Load dataset
miner <- data.frame(year=1:12, rate=c(2.419, 1.732, 1.361, 1.108, 0.996, 0.952, 0.904, 0.792, 0.701, 0.890, 0.799, 1.084))

# a) Scatter plot
plot(miner$year, miner$rate, main="Fatality Rate vs Year", xlab="Year", ylab="Fatality Rate")

# b) Least-squares regression line
model_9b <- lm(rate ~ year, data=miner)
summary(model_9b)

# c) Transformation with ln(x)
miner$log_year <- log(miner$year)
model_9c <- lm(rate ~ log_year, data=miner)
summary(model_9c)

# d) Transformation with 1/x
miner$inv_year <- 1 / miner$year
model_9d <- lm(rate ~ inv_year, data=miner)
summary(model_9d)

# e) Choose best model based on R-squared and p-value comparisons
## Based on the R^2 value and p-values, the first model had the moderate R^2 with the at least half of the variance explained and the p-value just above the significance interval suggesting near statistical significance.

# f) Use best model to predict rate for year 9
predict(model_9b, newdata=data.frame(year=9)) # Replace model if another is best
```

# Question 10

```{r, out.width="60%",}
# a) Numerical summaries
summary(hospital$expadm)
summary(hospital$los)

# b) Histograms
hist(hospital$expadm, main = "Histogram of Expense per Admission", xlab = "Expense per Admission")
hist(hospital$los, main = "Histogram of Length of Stay", xlab = "Length of Stay")

# c) Least-squares regression line
model_exp_los <- lm(expadm ~ los, data = hospital)
summary(model_exp_los)

# d) Interpretation of the slope
# This describes the change in expense per admission with each additional day in length of stay. While the p-value for the b1 is less than .05, we can conclude that b1 differs significancly from zero.

# e) Diagnostic plots (4 plots)
par(mfrow=c(2,2))
plot(model_exp_los)

```

# Question 11
```{r, out.width="60%",}
# Load dataset
lowbwt <- read_excel("lowbwt.xls")

# (a) Construct a model using gestational age and Apgar score to predict systolic blood pressure
model_11 <- lm(sbp ~ gestage + apgar5, data = lowbwt)
summary(model_11)

# (b) Test the null hypothesis that b1 = 0
# When we check the p-value for gestage, we see that it is below the significance level, just like the overall p-value from the summary. We reject the null hypothesis suggesting statistical significance.

# (c) Interpretation of b1 and b2 (gestage and apgar5 coefficients)
# From the summary, we can see that both b1 and b2 are positive values for positive correlations, for b1 it is significant with a p-value below .05, while b2 is not with a p-value over the significance level. 


# (d) Predicted systolic BP for gestage = 31 and apgar5 = 7
predict(model_11, data.frame(gestage = 31, apgar5 = 7))

# (e) Interpret R-squared
# From the summary output, we see a very low R^2 value, suggesting that our model has a low amount of explained variance. While error is still present, it is not explained by the model.

# (f) Assumption check (normality of residuals)
par(mfrow = c(2, 2))
plot(model_11)

```

# Question 12
```{r, out.width="60%",}
# (a) Construct model with gestage, apgar5, and sex as predictors
model_12a <- lm(sbp ~ gestage + apgar5 + sex, data = lowbwt)
summary(model_12a)

# (b) Adding interaction between gestage and sex
model_12b <- lm(sbp ~ gestage * sex + apgar5, data = lowbwt)
summary(model_12b)

# Based on the P-values which for both models are below .05, they both have statistical significance. The first one has a lower score. But looking at the interaction term in the 2nd model, it's p-value is quite high suggesting that the interaction doesn't have statistical significance. 
```
# Question 13
```{r, out.width="60%",}
# Load dataset
heart <- read_excel("heart.xls")


# Fit separate linear regression models for PDI and MDI
model_13_pdi <- lm(pdi ~ trtment, data = heart)
summary(model_13_pdi)

model_13_mdi <- lm(mdi ~ trtment, data = heart)
summary(model_13_mdi)

# The first model with pdi was the more statistically significant model with a p-value below the significance level.

```

# Question 14
```{r, out.width="60%",}
# a. Scatter plot
plot(hospital$salary, hospital$expadm, main = "Expense per Admission vs Salary", xlab = "Salary", ylab = "Expense per Admission")

# b. Multiple regression
model9 <- lm(expadm ~ los + salary, data = hospital)
summary(model9)

# c. 
# Yes, the addition of length of stay does make the model better. From the summary we can see that the p-values for b1 and overall are well beloe 0.05, suggesting they have a high significance value. The R^2 value is also high, suggesting a high amount of variance in the model can be explained. 

```

# Question 15
```{r, out.width="60%",}
detroit <- read_excel("detroit.xls")
# a. Multiple linear regression for homicide with predictors
lm_homicide <- lm(homicide ~ register + police + unemp + weekly, data = detroit)
summary(lm_homicide)

#b-d
# Based on the summary, register is the only variable which has a significant effect (but low positive correlation) on homocide rate. We can say this model is the best since the p-value is below the significance level and with a high R^2 value showing almost all of the variance explained by the model.


```

# Question 16
```{r, out.width="60%",}

# a. Logistic regression for hemorrhage
glm_hemorrhage <- glm(grmhem ~ apgar5 + tox, family = binomial, data = lowbwt)
summary(glm_hemorrhage)

# b. Predicted probability for apgar5 = 3 and tox = 1
predict(glm_hemorrhage, newdata = data.frame(apgar5 = 3, tox = 1), type = "response")

# c. Hypothesis test for b1
# Based on the model summary, we see b1 (agpar5) has a p-value below the significance level suggesting that the b1 differs significantly from zero. We reject the null hypothesis. 

```

# Question 17
```{r, out.width="60%",}
# Load dataset
stenosis <- read_excel("stenosis.xls")

# a) Logistic regression model for aortic stenosis with smoking and gender
model_17a <- glm(disease ~ smoke + sex, family="binomial", data=stenosis)
summary(model_17a)

# Interpretation of odds
exp(coef(model_17a)[2]) # Odds ratio for smokers vs nonsmokers

# b) Discuss interaction effects
# Based on the model summary, I believe that the presence of aortic stenosis differs between males and females. The coefficient b2 for sex is below 0.05 suggesting statistical significance.

```

# Question 18
```{r, out.width="60%",}
# Load dataset
dialysis <- read_excel("dialysis.xls")
View(dialysis)

# a) Logistic regression for age, sex, and race effects on peritonitis
model_18a_age <- glm(perito ~ age, family="binomial", data=dialysis)
model_18a_sex <- glm(perito ~ sex, family="binomial", data=dialysis)
model_18a_race <- glm(perito ~ race, family="binomial", data=dialysis)
summary(model_18a_age)
summary(model_18a_sex)
summary(model_18a_race)

# b) Prediction for white male, age 50
predict(model_18a_age, newdata=data.frame(age=50, sex=0, race=0), type="response")

# c) Response Variable Categorization
# Yes I do see a problem specifically with how age is categorized in comparison to the other variables. While the other variables are in binomial form (binary), the presence of a ordinal set of data is mixed with the bigger data meaning that it can obscure our model and some of our interpretations since it is not consistent.

```

# Question 19
```{r, out.width="60%",}
# Load dataset
cyto <- read_excel("cyto.xls")
view(cyto)

# a) Survival curves for two treatment groups
cyto_surv <- Surv(cyto$time, cyto$censor)
surv_fit <- survfit(cyto_surv ~ cyto$group)
plot(surv_fit, col=c("red", "blue"))

# b) Compare survival times visually
# By inspecting the survival plot, we the blue treatment group has a much higher survival time almost 2x more than the other. 

# c) Log-rank test
survdiff(cyto_surv ~ cyto$group)
# Based on the summary, we see a p-value below the significance value therefore we reject the null hypothesis. 

```
# Question 20
```{r, out.width="60%",}
# a) Survival curves by treatment group
bladder_surv <- survfit(Surv(time, censor) ~ group, data = bladder)
plot(bladder_surv, main = "Survival Curves by Treatment Group")

# b) Based on the plot, it doesn't seem like the individuals from one group have a significantly longer time to first recurrence of tumor. As we can tell, the behaviors and trends of both groups are very similar.

# c) 
survdiff(Surv(time, censor) ~ group, data = bladder)
# Based on the summary p-value, it is above the significance level and we fail to reject the null hypothesis that the recurrence times are identical between the two groups. 
```





















